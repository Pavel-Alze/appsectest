 # appsectest

Тестовое задание на стажировку AppSecCloudCamp

# 1. Вопросы для разогрева
Расскажите, с какими задачами в направлении безопасной разработки вы сталкивались?

- В учебной практике сталкивался с задачами реализации безопасного доступа к данным, управление доступом, разграничение прав и привилегий. Также мне необходимо было разработать сервер с базой данных и избежать sql-инъекций. Помимо этого во время разработки мне необходимо было покрыть код обработкой ошибок, логированием и структурированием кода. Данные проходили промежуточные процессы обрёртки между слоем вэб-контроллеров и слоем БД.

Если вам приходилось проводить security code review или моделирование угроз, расскажите, как это было?

- Данного опыта не имею, даже в качестве учебного процесса, но я заинтересован в том, чтобы его приобрести

Если у вас был опыт поиска уязвимостей, расскажите, как это было?

- В ходе выполнения лабораторных работ, мне необходимо было исследовать тренировочный сайт на предмет наличия различных уязвимостей (SQL-ijection, Command-injection, XSS, Reflected XSS, File inclusion) на разных уровнях сложностях, и дальнейшее их устранение через WAF (по ТЗ необходимо было сделать экранирование)

Почему вы хотите участвовать в стажировке?

- Мне интересно направление безопасной разработки, мне интересна работа с контейнеризацией и считаю, что инстурменты, относящиеся к данной технологии могут расширить возможности в плане создания безопасного, оптимизированного ПО. Стажировка для меня - возможность проявить свои теоретические навыки, получить реальный опыт работы в этой области, а также выявить и устранить пробелы в навыках, которые были приобретены в обычном учебном процессе.



# 2. Security code review

# Часть 1. Security code review: GO

Требуется провести анализ кода на GO с точки зрения безопасности и подготовить отчет по следующим пунктам:

1)Какие уязвимости присутствуют в этом фрагменте кода?

2)Указать строки, в которых присутствуют уязвимости.

3)К каким последствиям может привести эксплуатация найденных уязвимостей злоумышленником?

4)Описать способы исправления уязвимостей.

5)Если уязвимость можно исправить несколькими способами, необходимо перечислить их, выбрать лучший по вашему мнению и аргументировать свой выбор.

# Ответ
В данном коде мною были обнаружены следующие уязвимости:

   1. SQL-injection >>  query := fmt.Sprintf("SELECT * FROM products WHERE name LIKE '%%%s%%'", searchQuery)
      
   Здесь совершается запрос к БД с использованием строки запроса, которая никак не обрабатывается/проверяется. Данная уязвимость может позволить злоумышленнику узнать конфиденциальные/полезные данные из БД, либо провзаимодействовать со структурой БД.
   
   Есть несколько способов избавиться от этой уязвимости на стороне сервера: использование ORM и Экранирование. 
   
   Встроенный механизм ORM, который преобразует пользовательский запрос в запрос к бд, не позволит провести атаку. Экранирование символов, позволит избежать атаки на этапе проверки запроса. Можно сделать проверку на наличие определённых символов ( ' ) и фраз ( UNION ) и другие. 
   
   Для данного кода я бы предложил использовать вариант с экранирование, потому как для небольшой, тривиальной задачи по выводу продуктов использование ORM будет излишним.



   2. Открытое использование пары логин:пароль при инициализации БД >> db, err = sql.Open("mysql", "user:password@/dbname")

   Если злоумышленник сможет получить доступ до файла с исполяемым кодом, то сможет узнать авторизационные данные для доустпа к БД. 

   Рекомендуется использование отдельного конфигурационного файла или указание данных через параметры при запуске программы.



   3. Использование необработанных ошибок в логировании. Как таковой уязвимостью это не является, но в случае получения доступа злоумышленника к логам сервера, он может узнать данные о БД и коде по логам. Рекомендуется обрабатывать сообщения ошибок перед их логгированием



# Часть 2: Security code review: Python

Требуется определить тип уязвимости в примерах кода на Python и ответить на следующие вопросы:

Указать строки, в которых присутствуют уязвимости.

К каким последствиям может привести эксплуатация данных уязвимостей злоумышленником?

Описать способы исправления уязвимостей.

Если уязвимость можно исправить несколькими способами, необходимо перечислить их, выбрать лучший по вашему мнению и аргументировать свой выбор.



# Пример №2.1

 1. Необработанные ошибки
    
    Отсутствие проверки на наличие параметра name в пришедшем запросе >> name = request.values.get('name') и ошибка выполнения рендера >> output = Template('Hello ' + name + '! Your age is ' + age + '.').render()

    Во второй строке, как таковой проблемы нет, но возникновение ошибки возможно всегда.

    Может вызваться необработанная ошибка и программа остановится с кодом 1 (ошибка).

    Необходимо добавить обработку ошибки или устанавливать значение по умолчанию. Однако я считаю, что любой код должен быть покрыт обработкой ошибок.

 2. XSS attack >> output = Template('Hello ' + name + '! Your age is ' + age + '.').render()
    
    Так как в шаблон для отображения вставляются необработанные данные, то злоумышленнику не составит вписать в поле "name" вредоносный скрпит, который потом будет работать на сайте, где размещено сообщение.

    Через эту атаку, можно получить данные о пользователях, куки-файлы, сессионные токены и т.д.

    Решением является валидация приходящих данных.



 # Пример №2.2

 1. Отсутствие проверки на наличие параметра hostname в пришедшем запросе >> hostname = request.values.get('hostname') и ошибка выполнения рендера >> output = subprocess.check_output(cmd, shell=True, text=True)

    Во второй строке, как таковой проблемы нет, но возникновение ошибки возможно всегда.

    Может вызваться необработанная ошибка и программа остановится с кодом 1 (ошибка).

    Необходимо добавить обработку ошибки или устанавливать значение по умолчанию. Однако я считаю, что любой код должен быть покрыт обработкой ошибок.

 2. Command injection >> output = subprocess.check_output(cmd, shell=True, text=True)

    Через данную атаку можно провести сразу несколько других, например загрузка файла, пересылка на сайт и т.д. Это очень опасная уязвимость. Реализовать её можно логические операторы && в строке hosyname, которая просто записывается в конец переменной cmd.

    Решением может служить валидация данных, использование методов, принимающих параметры, а не строку, а так же собственно ручный шаблонизатор. Лучшим решением считаю использование шаблонизатора.

